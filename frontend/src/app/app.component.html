<!-- Mall Application Template - Version avec Notifications -->
<div class="mall-app">
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="logo">
        <h1>ğŸ¬ {{ title() }}</h1>
      </div>
      <nav class="nav">
        <!-- Si utilisateur connectÃ© -->
        <div *ngIf="isLoggedIn" class="user-info">
          <div class="nav-menu">
            <!-- Navigation -->
            <button 
              class="nav-btn"
              [class.active]="currentView === 'home'"
              (click)="setView('home')">
              ğŸ  Accueil
            </button>
            
            <!-- Notifications (tous les utilisateurs connectÃ©s) -->
            <button 
              class="nav-btn notification-btn"
              [class.active]="currentView === 'notifications'"
              (click)="setView('notifications')"
              *ngIf="canViewNotifications()">
              ğŸ”” Notifications
              <span class="notification-badge" *ngIf="unreadNotifications > 0">
                {{ unreadNotifications }}
              </span>
            </button>
            
            <!-- Gestion boutiques (admin seulement) -->
            <button 
              class="nav-btn"
              [class.active]="currentView === 'admin-boutiques'"
              (click)="setView('admin-boutiques')"
              *ngIf="canViewAdminBoutiques()">
              ğŸª Boutiques
            </button>
            
            <!-- Inscription boutique (boutique seulement) -->
            <button 
              class="nav-btn"
              [class.active]="currentView === 'boutique-registration'"
              (click)="setView('boutique-registration')"
              *ngIf="canViewBoutiqueRegistration()">
              â• Nouvelle Boutique
            </button>
            
            <!-- Mes boutiques (boutique seulement) -->
            <button 
              class="nav-btn"
              [class.active]="currentView === 'my-boutiques'"
              (click)="setView('my-boutiques')"
              *ngIf="canViewBoutiqueRegistration()">
              ğŸª Mes Boutiques
            </button>
          </div>
          
          <div class="user-profile">
            <span class="user-welcome">
              {{ getRoleIcon(currentUser?.role || '') }} 
              {{ currentUser?.prenom }}
            </span>
            <button class="btn-secondary" (click)="logout()">
              ğŸšª DÃ©connexion
            </button>
          </div>
        </div>
        
        <!-- Si utilisateur non connectÃ© -->
        <div *ngIf="!isLoggedIn" class="auth-buttons">
          <button class="btn-primary" (click)="showLogin = !showLogin; showRegister = false">
            {{ showLogin ? 'Fermer' : 'ğŸ” Connexion' }}
          </button>
          <button class="btn-outline" (click)="showRegister = !showRegister; showLogin = false">
            {{ showRegister ? 'Fermer' : 'ğŸ“ Inscription' }}
          </button>
        </div>
      </nav>
    </div>
  </header>

  <!-- Modal de Connexion -->
  <div class="auth-modal" [class.show]="showLogin" *ngIf="showLogin">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ” Connexion</h2>
        <button class="close-btn" (click)="showLogin = false">Ã—</button>
      </div>
      
      <form (ngSubmit)="login()">
        <!-- SÃ©lection du rÃ´le -->
        <div class="form-group">
          <label for="loginRole">RÃ´le :</label>
          <select id="loginRole" [(ngModel)]="loginForm.role" name="role" class="form-select">
            <option value="client">ğŸ›ï¸ Client</option>
            <option value="boutique">ğŸª Boutique</option>
            <option value="admin">ğŸ‘¨â€ğŸ’¼ Administrateur</option>
          </select>
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="loginEmail">Email :</label>
          <input 
            type="email" 
            id="loginEmail" 
            [(ngModel)]="loginForm.email" 
            name="email"
            placeholder="Votre email"
            required>
        </div>

        <!-- Mot de passe -->
        <div class="form-group">
          <label for="loginPassword">Mot de passe :</label>
          <input 
            type="password" 
            id="loginPassword" 
            [(ngModel)]="loginForm.password" 
            name="password"
            placeholder="Votre mot de passe"
            required>
        </div>

        <button type="submit" class="btn-primary btn-full">Se connecter</button>
      </form>

      <!-- Profils de dÃ©monstration -->
      <div class="demo-profiles">
        <h3>ğŸ­ Comptes de dÃ©monstration :</h3>
        <div class="demo-grid">
          <div 
            *ngFor="let profile of demoProfiles" 
            class="demo-card"
            [style.border-color]="getRoleColor(profile.role)"
            (click)="selectDemoProfile(profile)">
            <div class="demo-icon">{{ getRoleIcon(profile.role) }}</div>
            <div class="demo-info">
              <strong>{{ profile.role | titlecase }}</strong>
              <small>{{ profile.email }}</small>
            </div>
          </div>
        </div>
        <p class="demo-note">Cliquez sur un profil pour prÃ©-remplir le formulaire</p>
      </div>

      <div class="modal-footer">
        <p>Pas encore de compte ? 
          <a href="#" (click)="toggleAuthMode(); $event.preventDefault()">S'inscrire</a>
        </p>
      </div>
    </div>
  </div>

  <!-- Modal d'Inscription -->
  <div class="auth-modal" [class.show]="showRegister" *ngIf="showRegister">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ“ Inscription</h2>
        <button class="close-btn" (click)="showRegister = false">Ã—</button>
      </div>
      
      <form (ngSubmit)="register()">
        <!-- SÃ©lection du rÃ´le -->
        <div class="form-group">
          <label for="registerRole">RÃ´le :</label>
          <select id="registerRole" [(ngModel)]="registerForm.role" name="role" class="form-select">
            <option value="client">ğŸ›ï¸ Client</option>
            <option value="boutique">ğŸª Boutique (validation admin requise)</option>
          </select>
        </div>

        <!-- Informations personnelles -->
        <div class="form-row">
          <div class="form-group">
            <label for="registerNom">Nom * :</label>
            <input 
              type="text" 
              id="registerNom" 
              [(ngModel)]="registerForm.nom" 
              name="nom"
              placeholder="Votre nom"
              required>
          </div>
          <div class="form-group">
            <label for="registerPrenom">PrÃ©nom * :</label>
            <input 
              type="text" 
              id="registerPrenom" 
              [(ngModel)]="registerForm.prenom" 
              name="prenom"
              placeholder="Votre prÃ©nom"
              required>
          </div>
        </div>

        <!-- Email et mot de passe -->
        <div class="form-group">
          <label for="registerEmail">Email * :</label>
          <input 
            type="email" 
            id="registerEmail" 
            [(ngModel)]="registerForm.email" 
            name="email"
            placeholder="Votre email"
            required>
        </div>

        <div class="form-group">
          <label for="registerPassword">Mot de passe * :</label>
          <input 
            type="password" 
            id="registerPassword" 
            [(ngModel)]="registerForm.password" 
            name="password"
            placeholder="Minimum 6 caractÃ¨res"
            required>
        </div>

        <!-- Informations optionnelles -->
        <div class="form-group">
          <label for="registerTelephone">TÃ©lÃ©phone :</label>
          <input 
            type="tel" 
            id="registerTelephone" 
            [(ngModel)]="registerForm.telephone" 
            name="telephone"
            placeholder="Votre numÃ©ro de tÃ©lÃ©phone">
        </div>

        <div class="form-group">
          <label for="registerAdresse">Adresse :</label>
          <textarea 
            id="registerAdresse" 
            [(ngModel)]="registerForm.adresse" 
            name="adresse"
            placeholder="Votre adresse complÃ¨te"
            rows="2"></textarea>
        </div>

        <!-- Avertissement pour les boutiques -->
        <div class="boutique-warning" *ngIf="registerForm.role === 'boutique'">
          <p>âš ï¸ <strong>Important :</strong> Les inscriptions boutiques nÃ©cessitent une validation par un administrateur. Vous recevrez un email une fois votre demande traitÃ©e.</p>
        </div>

        <button type="submit" class="btn-primary btn-full">S'inscrire</button>
      </form>

      <!-- Profils de dÃ©monstration -->
      <div class="demo-profiles">
        <h3>ğŸ­ Profils de test :</h3>
        <div class="demo-grid">
          <div 
            *ngFor="let profile of demoProfiles.slice(1)" 
            class="demo-card"
            [style.border-color]="getRoleColor(profile.role)"
            (click)="selectDemoProfile(profile)">
            <div class="demo-icon">{{ getRoleIcon(profile.role) }}</div>
            <div class="demo-info">
              <strong>{{ profile.role | titlecase }}</strong>
              <small>{{ profile.nom }} {{ profile.prenom }}</small>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <p>DÃ©jÃ  un compte ? 
          <a href="#" (click)="toggleAuthMode(); $event.preventDefault()">Se connecter</a>
        </p>
      </div>
    </div>
  </div>

  <!-- Contenu Principal -->
  <main class="main-content">
    <div class="container">
      
      <!-- Vue Accueil -->
      <div *ngIf="currentView === 'home'">
        <!-- Section Hero -->
        <section class="hero">
          <h2>Bienvenue dans votre Centre Commercial</h2>
          <p *ngIf="!isLoggedIn">Connectez-vous pour dÃ©couvrir toutes nos fonctionnalitÃ©s</p>
          <p *ngIf="isLoggedIn">
            Bonjour {{ currentUser?.prenom }}, 
            <span [style.color]="getRoleColor(currentUser?.role || '')">
              {{ getRoleIcon(currentUser?.role || '') }} {{ currentUser?.role | titlecase }}
            </span>
          </p>
          
          <!-- Statut Backend -->
          <div class="api-status">
            <span class="status-label">Backend :</span>
            <span class="status-value">{{ backendStatus }}</span>
          </div>
        </section>

        <!-- Dashboard utilisateur connectÃ© -->
        <section *ngIf="isLoggedIn" class="user-dashboard">
          <h2>{{ getRoleIcon(currentUser?.role || '') }} Dashboard {{ currentUser?.role | titlecase }}</h2>
          
          <div class="dashboard-cards">
            <!-- Admin Dashboard -->
            <div *ngIf="currentUser?.role === 'admin'" class="dashboard-card">
              <h3>ğŸ‘¨â€ğŸ’¼ Gestion Administrative</h3>
              <ul>
                <li>ğŸ”” {{ unreadNotifications }} notifications non lues</li>
                <li>ğŸª Gestion des boutiques</li>
                <li>ğŸ‘¥ Gestion des utilisateurs</li>
                <li>ğŸ“ˆ Rapports et analytics</li>
              </ul>
              <div class="card-actions">
                <button class="btn-card" (click)="setView('notifications')">
                  ğŸ”” Voir notifications
                </button>
                <button class="btn-card" (click)="setView('admin-boutiques')">
                  ğŸª GÃ©rer boutiques
                </button>
              </div>
            </div>

            <!-- Boutique Dashboard -->
            <div *ngIf="currentUser?.role === 'boutique'" class="dashboard-card">
              <h3>ğŸª Gestion de Boutiques</h3>
              <ul>
                <li>ğŸª Mes boutiques (multi-boutiques)</li>
                <li>â• CrÃ©er une nouvelle boutique</li>
                <li>ğŸ“¦ Gestion des produits</li>
                <li>ğŸ“‹ Suivi des commandes</li>
                <li>ğŸ’° Tableau de bord des ventes</li>
                <li>âš™ï¸ ParamÃ¨tres des boutiques</li>
              </ul>
              <div class="card-actions">
                <button class="btn-card" (click)="setView('my-boutiques')">
                  ğŸª Mes boutiques
                </button>
                <button class="btn-card" (click)="setView('boutique-registration')">
                  â• Nouvelle boutique
                </button>
                <button class="btn-card" (click)="setView('notifications')">
                  ğŸ”” Notifications
                </button>
              </div>
            </div>

            <!-- Client Dashboard -->
            <div *ngIf="currentUser?.role === 'client'" class="dashboard-card">
              <h3>ğŸ›ï¸ Espace Client</h3>
              <ul>
                <li>ğŸ›’ Mes commandes</li>
                <li>â¤ï¸ Mes favoris</li>
                <li>ğŸ‘¤ Mon profil</li>
                <li>ğŸ¯ Recommandations</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- FonctionnalitÃ©s gÃ©nÃ©rales -->
        <section *ngIf="!isLoggedIn" class="features">
          <h2>FonctionnalitÃ©s</h2>
          <div class="features-grid">
            <div class="feature-card">
              <h3>ğŸ‘¨â€ğŸ’¼ Interface Admin</h3>
              <p>Gestion complÃ¨te du centre commercial avec notifications</p>
            </div>
            <div class="feature-card">
              <h3>ğŸª Interface Boutique</h3>
              <p>Inscription avec validation admin et outils de gestion</p>
            </div>
            <div class="feature-card">
              <h3>ğŸ›ï¸ Interface Client</h3>
              <p>Shopping et services personnalisÃ©s</p>
            </div>
          </div>
        </section>
      </div>

      <!-- Vue Notifications -->
      <div *ngIf="currentView === 'notifications' && canViewNotifications()">
        <app-notifications></app-notifications>
      </div>

      <!-- Vue Admin Boutiques -->
      <div *ngIf="currentView === 'admin-boutiques' && canViewAdminBoutiques()">
        <app-admin-boutiques></app-admin-boutiques>
      </div>

      <!-- Vue Inscription Boutique -->
      <div *ngIf="currentView === 'boutique-registration' && canViewBoutiqueRegistration()">
        <app-boutique-registration></app-boutique-registration>
      </div>

      <!-- Vue Mes Boutiques -->
      <div *ngIf="currentView === 'my-boutiques' && canViewBoutiqueRegistration()">
        <app-my-boutiques></app-my-boutiques>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>&copy; 2026 Centre Commercial - Application MEAN Stack</p>
      <p>Angular SPA + Express.js + MongoDB + SystÃ¨me de Notifications</p>
    </div>
  </footer>
</div>

<router-outlet />